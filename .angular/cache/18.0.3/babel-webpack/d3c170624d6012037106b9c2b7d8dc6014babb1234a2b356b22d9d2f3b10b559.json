{"ast":null,"code":"import { of } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/fire/compat/firestore\";\nexport class FirebaseService {\n  constructor(firestore) {\n    this.firestore = firestore;\n    this.collectionName = 'reservas';\n  }\n  addReserva(reserva) {\n    return this.firestore.collection(this.collectionName).add(reserva);\n  }\n  getReservasPorDataETipo(data, tipoMesa) {\n    return this.firestore.collection(this.collectionName, ref => ref.where('data', '==', data).where('tipoMesa', '==', tipoMesa)).snapshotChanges().pipe(map(actions => {\n      return actions.map(a => {\n        const data = a.payload.doc.data();\n        const id = a.payload.doc.id;\n        return {\n          id,\n          ...data\n        };\n      });\n    }), catchError(error => {\n      console.error('Erro ao buscar reservas por data e tipo: ', error);\n      return of([]);\n    }));\n  }\n  getReservas() {\n    return this.firestore.collection(this.collectionName).snapshotChanges().pipe(map(actions => {\n      return actions.map(a => {\n        const data = a.payload.doc.data();\n        const id = a.payload.doc.id;\n        return {\n          id,\n          ...data\n        };\n      });\n    }), catchError(error => {\n      console.error('Erro ao buscar reservas: ', error);\n      return of([]);\n    }));\n  }\n  updateReserva(id, data) {\n    return this.firestore.doc(`${this.collectionName}/${id}`).update(data);\n  }\n  deleteReserva(id) {\n    return this.firestore.doc(`${this.collectionName}/${id}`).delete();\n  }\n  deleteExpiredReservas() {\n    const now = new Date();\n    const currentDate = now.toISOString().split('T')[0];\n    const currentTime = `${now.getHours()}:${now.getMinutes()}`;\n    return this.firestore.collection(this.collectionName).ref.get().then(snapshot => {\n      const batch = this.firestore.firestore.batch();\n      snapshot.forEach(doc => {\n        const reserva = doc.data();\n        if (reserva.data < currentDate || reserva.data === currentDate && reserva.horario < currentTime) {\n          batch.delete(doc.ref);\n        }\n      });\n      return batch.commit();\n    });\n  }\n  static #_ = this.ɵfac = function FirebaseService_Factory(t) {\n    return new (t || FirebaseService)(i0.ɵɵinject(i1.AngularFirestore));\n  };\n  static #_2 = this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: FirebaseService,\n    factory: FirebaseService.ɵfac,\n    providedIn: 'root'\n  });\n}","map":{"version":3,"names":["of","map","catchError","FirebaseService","constructor","firestore","collectionName","addReserva","reserva","collection","add","getReservasPorDataETipo","data","tipoMesa","ref","where","snapshotChanges","pipe","actions","a","payload","doc","id","error","console","getReservas","updateReserva","update","deleteReserva","delete","deleteExpiredReservas","now","Date","currentDate","toISOString","split","currentTime","getHours","getMinutes","get","then","snapshot","batch","forEach","horario","commit","_","i0","ɵɵinject","i1","AngularFirestore","_2","factory","ɵfac","providedIn"],"sources":["C:\\Users\\enzod\\integrador-07_07\\Integrador_reservas\\src\\app\\firebase.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { AngularFirestore } from '@angular/fire/compat/firestore';\r\nimport { Observable, of } from 'rxjs';\r\nimport { map, catchError } from 'rxjs/operators';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class FirebaseService {\r\n\r\n  private collectionName = 'reservas';\r\n\r\n  constructor(private firestore: AngularFirestore) { }\r\n\r\n  addReserva(reserva: any): Promise<any> {\r\n    return this.firestore.collection(this.collectionName).add(reserva);\r\n  }\r\n\r\n  getReservasPorDataETipo(data: string, tipoMesa: string): Observable<any> {\r\n    return this.firestore.collection(this.collectionName, ref => \r\n      ref.where('data', '==', data).where('tipoMesa', '==', tipoMesa)\r\n    ).snapshotChanges().pipe(\r\n      map(actions => {\r\n        return actions.map(a => {\r\n          const data = a.payload.doc.data() as any;\r\n          const id = a.payload.doc.id;\r\n          return { id, ...data };\r\n        });\r\n      }),\r\n      catchError(error => {\r\n        console.error('Erro ao buscar reservas por data e tipo: ', error);\r\n        return of([]);\r\n      })\r\n    );\r\n  }\r\n\r\n  getReservas(): Observable<any[]> {\r\n    return this.firestore.collection(this.collectionName).snapshotChanges().pipe(\r\n      map(actions => {\r\n        return actions.map(a => {\r\n          const data = a.payload.doc.data() as any;\r\n          const id = a.payload.doc.id;\r\n          return { id, ...data };\r\n        });\r\n      }),\r\n      catchError(error => {\r\n        console.error('Erro ao buscar reservas: ', error);\r\n        return of([]);\r\n      })\r\n    );\r\n  }\r\n\r\n  updateReserva(id: string, data: any): Promise<void> {\r\n    return this.firestore.doc(`${this.collectionName}/${id}`).update(data);\r\n  }\r\n\r\n  deleteReserva(id: string): Promise<void> {\r\n    return this.firestore.doc(`${this.collectionName}/${id}`).delete();\r\n  }\r\n\r\n  deleteExpiredReservas(): Promise<void> {\r\n    const now = new Date();\r\n    const currentDate = now.toISOString().split('T')[0];\r\n    const currentTime = `${now.getHours()}:${now.getMinutes()}`;\r\n\r\n    return this.firestore.collection(this.collectionName).ref.get().then(snapshot => {\r\n      const batch = this.firestore.firestore.batch();\r\n      snapshot.forEach(doc => {\r\n        const reserva = doc.data() as any;\r\n        if (reserva.data < currentDate || (reserva.data === currentDate && reserva.horario < currentTime)) {\r\n          batch.delete(doc.ref);\r\n        }\r\n      });\r\n      return batch.commit();\r\n    });\r\n  }\r\n}\r\n"],"mappings":"AAEA,SAAqBA,EAAE,QAAQ,MAAM;AACrC,SAASC,GAAG,EAAEC,UAAU,QAAQ,gBAAgB;;;AAKhD,OAAM,MAAOC,eAAe;EAI1BC,YAAoBC,SAA2B;IAA3B,KAAAA,SAAS,GAATA,SAAS;IAFrB,KAAAC,cAAc,GAAG,UAAU;EAEgB;EAEnDC,UAAUA,CAACC,OAAY;IACrB,OAAO,IAAI,CAACH,SAAS,CAACI,UAAU,CAAC,IAAI,CAACH,cAAc,CAAC,CAACI,GAAG,CAACF,OAAO,CAAC;EACpE;EAEAG,uBAAuBA,CAACC,IAAY,EAAEC,QAAgB;IACpD,OAAO,IAAI,CAACR,SAAS,CAACI,UAAU,CAAC,IAAI,CAACH,cAAc,EAAEQ,GAAG,IACvDA,GAAG,CAACC,KAAK,CAAC,MAAM,EAAE,IAAI,EAAEH,IAAI,CAAC,CAACG,KAAK,CAAC,UAAU,EAAE,IAAI,EAAEF,QAAQ,CAAC,CAChE,CAACG,eAAe,EAAE,CAACC,IAAI,CACtBhB,GAAG,CAACiB,OAAO,IAAG;MACZ,OAAOA,OAAO,CAACjB,GAAG,CAACkB,CAAC,IAAG;QACrB,MAAMP,IAAI,GAAGO,CAAC,CAACC,OAAO,CAACC,GAAG,CAACT,IAAI,EAAS;QACxC,MAAMU,EAAE,GAAGH,CAAC,CAACC,OAAO,CAACC,GAAG,CAACC,EAAE;QAC3B,OAAO;UAAEA,EAAE;UAAE,GAAGV;QAAI,CAAE;MACxB,CAAC,CAAC;IACJ,CAAC,CAAC,EACFV,UAAU,CAACqB,KAAK,IAAG;MACjBC,OAAO,CAACD,KAAK,CAAC,2CAA2C,EAAEA,KAAK,CAAC;MACjE,OAAOvB,EAAE,CAAC,EAAE,CAAC;IACf,CAAC,CAAC,CACH;EACH;EAEAyB,WAAWA,CAAA;IACT,OAAO,IAAI,CAACpB,SAAS,CAACI,UAAU,CAAC,IAAI,CAACH,cAAc,CAAC,CAACU,eAAe,EAAE,CAACC,IAAI,CAC1EhB,GAAG,CAACiB,OAAO,IAAG;MACZ,OAAOA,OAAO,CAACjB,GAAG,CAACkB,CAAC,IAAG;QACrB,MAAMP,IAAI,GAAGO,CAAC,CAACC,OAAO,CAACC,GAAG,CAACT,IAAI,EAAS;QACxC,MAAMU,EAAE,GAAGH,CAAC,CAACC,OAAO,CAACC,GAAG,CAACC,EAAE;QAC3B,OAAO;UAAEA,EAAE;UAAE,GAAGV;QAAI,CAAE;MACxB,CAAC,CAAC;IACJ,CAAC,CAAC,EACFV,UAAU,CAACqB,KAAK,IAAG;MACjBC,OAAO,CAACD,KAAK,CAAC,2BAA2B,EAAEA,KAAK,CAAC;MACjD,OAAOvB,EAAE,CAAC,EAAE,CAAC;IACf,CAAC,CAAC,CACH;EACH;EAEA0B,aAAaA,CAACJ,EAAU,EAAEV,IAAS;IACjC,OAAO,IAAI,CAACP,SAAS,CAACgB,GAAG,CAAC,GAAG,IAAI,CAACf,cAAc,IAAIgB,EAAE,EAAE,CAAC,CAACK,MAAM,CAACf,IAAI,CAAC;EACxE;EAEAgB,aAAaA,CAACN,EAAU;IACtB,OAAO,IAAI,CAACjB,SAAS,CAACgB,GAAG,CAAC,GAAG,IAAI,CAACf,cAAc,IAAIgB,EAAE,EAAE,CAAC,CAACO,MAAM,EAAE;EACpE;EAEAC,qBAAqBA,CAAA;IACnB,MAAMC,GAAG,GAAG,IAAIC,IAAI,EAAE;IACtB,MAAMC,WAAW,GAAGF,GAAG,CAACG,WAAW,EAAE,CAACC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;IACnD,MAAMC,WAAW,GAAG,GAAGL,GAAG,CAACM,QAAQ,EAAE,IAAIN,GAAG,CAACO,UAAU,EAAE,EAAE;IAE3D,OAAO,IAAI,CAACjC,SAAS,CAACI,UAAU,CAAC,IAAI,CAACH,cAAc,CAAC,CAACQ,GAAG,CAACyB,GAAG,EAAE,CAACC,IAAI,CAACC,QAAQ,IAAG;MAC9E,MAAMC,KAAK,GAAG,IAAI,CAACrC,SAAS,CAACA,SAAS,CAACqC,KAAK,EAAE;MAC9CD,QAAQ,CAACE,OAAO,CAACtB,GAAG,IAAG;QACrB,MAAMb,OAAO,GAAGa,GAAG,CAACT,IAAI,EAAS;QACjC,IAAIJ,OAAO,CAACI,IAAI,GAAGqB,WAAW,IAAKzB,OAAO,CAACI,IAAI,KAAKqB,WAAW,IAAIzB,OAAO,CAACoC,OAAO,GAAGR,WAAY,EAAE;UACjGM,KAAK,CAACb,MAAM,CAACR,GAAG,CAACP,GAAG,CAAC;QACvB;MACF,CAAC,CAAC;MACF,OAAO4B,KAAK,CAACG,MAAM,EAAE;IACvB,CAAC,CAAC;EACJ;EAAC,QAAAC,CAAA,G;qBAnEU3C,eAAe,EAAA4C,EAAA,CAAAC,QAAA,CAAAC,EAAA,CAAAC,gBAAA;EAAA;EAAA,QAAAC,EAAA,G;WAAfhD,eAAe;IAAAiD,OAAA,EAAfjD,eAAe,CAAAkD,IAAA;IAAAC,UAAA,EAFd;EAAM","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}